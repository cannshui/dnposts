## JavaScript 中布尔短路求值

### 背景

短路求值，指在某些编程语言中对表达式进行布尔计算的规则，由于像电路短路一样期望尽快返回，所以有了这种名称。短路求值规则规定，只当表达式的第一个参数无法决定整个表达式的值时，才去计算第二或后续参数的值。

布尔运算，涉及到两个操作符，`AND`（`&&`） 和 `OR`（`||`）。由 `AND` 所连接的两个参数只要有一个运算结果为 `false` 则整个表达式结果为 `false`，同时为 `true` 才为 `true`，短路原则下，如果第一个参数就为 `false`，则不对第二个参数求值，即可决定表达式值为 `false`；由 `OR` 所连接的两个参数只要有一个运算结果为 `true` 则为 `true`，同时为 `false` 才为 `false`，短路原则下，如果第一个表达式就为 `true`，则不对第二个参数求值，即可决定表达式值为 `true`。

 > **NOTE**
 >
 > 强调**运算结果**为布尔值，是因为某些语言在涉及布尔判断的地方会将不同的值映射到布尔值。如 JavaScript 中，0、""、undefined、null 会被运算为 `false`，非 0、非空字符串、对象等运算为 `true`。

 > **TIP**
 >
 > 短路原则下， `X AND Y` 等效于执行 `if X then Y else false` 的布尔结果；`X OR Y` 等效于执行 `if X then true else y` 的布尔结果。

不同编程语言中，对于短路求值结果是不同的。强数据类型的语言，如 Java，运算结果只能是 `true` 或 `false`。弱数据类型的语言，如 JavaScript，则会得到**使表达式发生短路返回**的参数的值。这正是写作本文的目的。这篇文章会列举几个小例子，说明 JavaScript 中短路求值规则的使用效果。

### 示例

 1. `||` 操作时，会依次从左到右运算 `||` 连接的参数，如果为 `true` 则结束，并将此参数的值赋值等号右边的变量。如下所示变量 `a1`：

		var a1 = 0 || "x" || 1; // a1 被赋值为 x

 2. 如果 `||` 连接的参数逻辑运算后全为 `false` 则返回最后一个参数的值。如下所示变量 `a2`：

		var a2 = 0 || null || undefined; // a2 被赋值为 undefined

 3. `&&` 操作时，会依次从左到右运算 `&&` 连接的参数，如果遇到 `false` 则结束，并将此参数的值赋值等号右边的变量。如下所示变量 `a3`：

		var a3 = "x" && "" && 1; // a3 被赋值为一个空串

 4. 如果 `&&` 连接的参数逻辑运算后全为 `true` 则返回最后一个参数的值。如下所示变量 `a4`，`a5`：

		var a4 = "x" && "y" && 100;// a4 被赋值为 100
		var a5 = "x" && "y" && 1 == 1;// a5 被赋值为 true

 5. 通过 `()` 改变优先级，如 `a6`，`a7`：

		var a6 = (0 && "x") || (100 && null && "y");// a6 被赋值为 null
		var a7 = (0 && "x") || (0 && null || "y");// a7 被赋值为 y

##### 6. 利用短路原则的编程实践

当没有参数时，用默认的设置进行填充。省掉 `if (!option) { option = defaultOption; }` 的写法，并没有牺牲可读性：

	function foo(option) {
		var defaultOption = { ... };
		option = option || defaultoption; // 使用默认值
	}

通过使用 `&&` 可以确保在使用一个变量前的安全性：

	var str = ...;
	str = str && str.length && str.substring(1);

三元表达式的等价实现：

	var condition = ...;
	var x = condition || 'false' && 'true';
	var x = condition ? 'true' : 'false';

### 总结

短路求值高效（因为不用计算多余的参数值）、书写简洁，便于编写紧凑的代码。只是有时太过简洁，可能就损失了可读性。所以在用与不用及什么场合用，需要做出权衡。
